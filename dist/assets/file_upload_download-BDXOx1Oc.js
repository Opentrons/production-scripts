import{d as ue,r as u,i as L,D as ce,b as d,G as pe,c as w,o as r,f as s,e as l,w as a,h as c,F as E,B as T,j as g,k as p,H as _e,I as P,y as k,J as ve,K as fe,L as me,M as R,g as S,N as ge,l as be,z as he,O as ye,$ as we,E as m,U as ke,_ as xe}from"./index-B-71tMiN.js";const Ce={class:"file-manager-container"},$e={class:"connection-bar"},ze={class:"connection-controls"},Be={class:"main-content"},Ue={class:"browser-header"},Le={class:"path-navigator"},De={class:"file-item"},Me={class:"file-name"},Fe={class:"upload-queue"},Ve={class:"file-info"},Ee={class:"file-progress"},Te={class:"file-actions"},je=ue({__name:"file_upload_download",setup(Ne){const y=u(""),D=u("/data/testing_data"),x=u([]),M=u(!1),I=u(!0),_=u(!1),C=u("/"),$=u("下载目录"),H=u([]),q=u(!1),A=L(()=>`/api/files/upload?device=${y.value}&path=${C.value}`),G=L(()=>({Authorization:I.value?"Bearer your-secret-token":""})),J=L(()=>({path:C.value})),v=u([]),K=t=>{if(t===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,i)).toFixed(2))+" "+n[i]},j=L(()=>C.value.split("/").filter(t=>t!==""));async function N(){M.value=!0,x.value=[];try{const e=(await we("/api/flex/discover")).flex_group;for(const i in e)x.value.push({value:i,label:`${e[i].name} (${i})`});const n=Object.keys(e).length;n>0&&(y.value=x.value[0].value,_.value=!0),m.info(`找到${n}个设备!`)}catch(t){console.error("Error:",t),m.error("设备刷新失败: "+t.message)}finally{M.value=!1}}const Q=t=>{t?_.value=!0:_.value=!1},X=async()=>{m.info("开始下载"),$.value="正在下载",_.value=!1;const t={host:y.value,user_name:"root",download_path:D.value,saved_name:"testing_data"};console.log(t);const e=await fetch(`${ke}/api/flex/download/testing_data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const z=await e.json();throw m.error(`下载失败, ${z.detail}`),$.value="下载目录",_.value=!0,new Error(z.detail||`HTTP error! status: ${e.status}`)}const i=e.headers.get("Content-Disposition")?.match(/filename="?(.+?)"?$/)?.[1]||"download.zip",F=await e.blob(),f=window.URL.createObjectURL(F),b=document.createElement("a");b.href=f,b.download=i,document.body.appendChild(b),b.click(),m.success("下载成功"),$.value="下载目录",_.value=!0,setTimeout(()=>{document.body.removeChild(b),window.URL.revokeObjectURL(f)},100)},O=async()=>{},W=t=>{const e=j.value.slice(0,t+1);C.value="/"+e.join("/"),O()},Y=async()=>{},Z=t=>t.size>100*1024*1024?(m.error("文件大小不能超过100MB"),!1):(v.value.push({name:t.name,size:t.size,progress:0,status:"uploading",file:t}),!0),ee=(t,e)=>{const n=v.value.findIndex(i=>i.name===e.name);n!==-1&&(v.value[n].progress=100,v.value[n].status="success"),O(),m.success(`${e.name} 上传成功`)},te=(t,e)=>{const n=v.value.findIndex(i=>i.name===e.name);n!==-1&&(v.value[n].status="exception"),m.error(`${e.name} 上传失败: ${t.message}`)},ae=t=>{v.value[t].status="exception",m.warning(`已取消上传: ${v.value[t].name}`)};return ce(()=>{N()}),(t,e)=>{const n=d("el-text"),i=d("el-option"),F=d("el-select"),f=d("el-button"),b=d("el-divider"),z=d("el-input"),V=d("el-card"),le=d("el-breadcrumb-item"),oe=d("el-breadcrumb"),B=d("el-icon"),U=d("el-table-column"),se=d("el-table"),ne=d("el-upload"),ie=d("el-progress"),de=pe("loading");return r(),w("div",Ce,[s("div",$e,[l(V,{shadow:"hover"},{default:a(()=>[s("div",ze,[l(n,{class:"control-label"},{default:a(()=>e[6]||(e[6]=[c("FLEX设备")])),_:1,__:[6]}),l(F,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),placeholder:"选择设备",style:{width:"300px"},filterable:"","allow-create":"",clearable:"",onChange:Q},{default:a(()=>[(r(!0),w(E,null,T(x.value,o=>(r(),g(i,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(f,{loading:M.value,type:"primary",size:"small",onClick:N,icon:p(_e)},{default:a(()=>e[7]||(e[7]=[c(" 刷新设备 ")])),_:1,__:[7]},8,["loading","icon"]),l(b,{direction:"vertical"}),l(n,{class:"control-label"},{default:a(()=>e[8]||(e[8]=[c("下载路径")])),_:1,__:[8]}),l(z,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=o=>D.value=o),style:{width:"300px"},placeholder:"/data/testing_data",clearable:""},null,8,["modelValue"]),l(f,{type:"primary",disabled:!_.value,onClick:X,icon:p(P),style:{"margin-left":"20px"}},{default:a(()=>[c(k($.value),1)]),_:1},8,["disabled","icon"]),l(f,{type:"danger",disabled:!_.value,onClick:e[2]||(e[2]=()=>{}),icon:p(ve),style:{"margin-left":"10px"}},{default:a(()=>e[9]||(e[9]=[c(" 删除目录 ")])),_:1,__:[9]},8,["disabled","icon"])])]),_:1})]),s("div",Be,[l(V,{class:"file-browser",shadow:"hover"},{header:a(()=>[s("div",Ue,[e[10]||(e[10]=s("span",null,"上传目录浏览器",-1)),s("div",Le,[l(oe,{separator:"/"},{default:a(()=>[(r(!0),w(E,null,T(j.value,(o,h)=>(r(),g(le,{key:h,onClick:re=>W(h)},{default:a(()=>[c(k(o||"根目录"),1)]),_:2},1032,["onClick"]))),128))]),_:1})])])]),default:a(()=>[fe((r(),g(se,{data:H.value,style:{width:"100%"},height:"100%",onRowClick:e[5]||(e[5]=()=>{})},{default:a(()=>[l(U,{prop:"name",label:"名称",width:"300"},{default:a(({row:o})=>[s("div",De,[o.type==="directory"?(r(),g(B,{key:0},{default:a(()=>[l(p(me))]),_:1})):(r(),g(B,{key:1},{default:a(()=>[l(p(R))]),_:1})),s("span",Me,k(o.name),1)])]),_:1}),l(U,{prop:"size",label:"大小",width:"120"},{default:a(({row:o})=>[c(k(o.type==="directory"?"-":K(o.size)),1)]),_:1}),l(U,{prop:"modified",label:"修改时间",width:"180"}),l(U,{label:"操作",width:"150",fixed:"right"},{default:a(({row:o})=>[o.type==="file"?(r(),g(f,{key:0,size:"small",type:"primary",onClick:e[3]||(e[3]=S(h=>Y(),["stop"])),icon:p(P)},{default:a(()=>e[11]||(e[11]=[c(" 下载 ")])),_:1,__:[11]},8,["icon"])):(r(),g(f,{key:1,size:"small",type:"info",onClick:e[4]||(e[4]=S(()=>{},["stop"])),icon:p(ge)},{default:a(()=>e[12]||(e[12]=[c(" 进入 ")])),_:1,__:[12]},8,["icon"]))]),_:1})]),_:1},8,["data"])),[[de,q.value]])]),_:1}),l(V,{class:"upload-panel",shadow:"hover"},{header:a(()=>e[13]||(e[13]=[s("span",null,"上传文件",-1)])),default:a(()=>[l(ne,{class:"upload-area",drag:"",multiple:"",action:A.value,headers:G.value,data:J.value,"before-upload":Z,"on-success":ee,"on-error":te,"show-file-list":!1,disabled:!_.value},{tip:a(()=>e[14]||(e[14]=[s("div",{class:"el-upload__tip"}," 支持上传多个文件，单文件最大100MB ",-1)])),default:a(()=>[l(B,{class:"el-icon--upload"},{default:a(()=>[l(p(be))]),_:1}),e[15]||(e[15]=s("div",{class:"el-upload__text"},[c(" 拖拽文件到此处或"),s("em",null,"点击上传")],-1))]),_:1,__:[15]},8,["action","headers","data","disabled"]),s("div",Fe,[(r(!0),w(E,null,T(v.value,(o,h)=>(r(),w("div",{key:o.name+h,class:"queue-item"},[s("div",Ve,[l(B,null,{default:a(()=>[l(p(R))]),_:1}),s("span",null,k(o.name),1)]),s("div",Ee,[l(ie,{percentage:o.progress,status:o.status,"stroke-width":12},null,8,["percentage","status"])]),s("div",Te,[o.status==="uploading"?(r(),g(f,{key:0,size:"small",type:"danger",onClick:re=>ae(h),icon:p(ye),circle:""},null,8,["onClick","icon"])):he("",!0)])]))),128))])]),_:1})])])}}}),Pe=xe(je,[["__scopeId","data-v-c4ea700a"]]);export{Pe as default};
