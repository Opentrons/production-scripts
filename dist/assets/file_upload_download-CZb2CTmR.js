import{d as ce,r as p,i as $,D as pe,b as d,G as _e,c as h,o as i,f as n,e as a,w as l,h as u,F as D,B as E,j as v,k as c,H as fe,I as ve,J as P,K as me,L as ge,M as ye,N as I,y as B,g as T,O as be,l as he,z as we,P as ke,$ as xe,E as _,Q as j,_ as Ce}from"./index-vttHtD4q.js";const $e={class:"file-manager-container"},Be={class:"connection-bar"},ze={class:"connection-controls"},Me={class:"main-content"},Fe={class:"browser-header"},Ve={class:"path-navigator"},De={class:"file-item"},Ee={class:"file-name"},Le={class:"upload-queue"},Ue={class:"file-info"},Ne={class:"file-progress"},Pe={class:"file-actions"},Ie=ce({__name:"file_upload_download",setup(Te){const g=p(""),z=p("/data/testing_data"),w=p([]),M=p(!1),S=p(!0),y=p(!1),k=p("/"),q=p([]),F=p(!1),G=$(()=>`/api/files/upload?device=${g.value}&path=${k.value}`),H=$(()=>({Authorization:S.value?"Bearer your-secret-token":""})),K=$(()=>({path:k.value})),f=p([]),O=t=>{if(t===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,r)).toFixed(2))+" "+s[r]},L=$(()=>k.value.split("/").filter(t=>t!==""));async function U(){M.value=!0,w.value=[];try{const e=(await xe("/api/flex/discover")).flex_group;for(const r in e)w.value.push({value:r,label:`${e[r].name} (${r})`});const s=Object.keys(e).length;s>0&&(g.value=w.value[0]),_.info(`找到${s}个设备!`)}catch(t){console.error("Error:",t),_.error("设备刷新失败: "+t.message)}finally{M.value=!1}}const Q=t=>{t?y.value=!0:y.value=!1},A=async()=>{try{F.value=!0,(await j("/api/flex/connect",{host:g.value})).success?_.success("连接成功"):_.error("连接失败")}catch(t){_.error("连接失败: "+t.message)}finally{F.value=!1}},J=async()=>{const t={host:g.value,user_name:"root",download_path:z.value,saved_name:"testing_data"};console.log(t);const e=await j("/api/flex/download/testing_data",t);if(e.success){_.info("开始下载");const s=document.createElement("a");s.href=`${window.location.origin}${e.dir}`,console.log(s.href),s.download=t.saved_name||"download",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},N=async()=>{},R=t=>{const e=L.value.slice(0,t+1);k.value="/"+e.join("/"),N()},X=async()=>{},W=t=>t.size>100*1024*1024?(_.error("文件大小不能超过100MB"),!1):(f.value.push({name:t.name,size:t.size,progress:0,status:"uploading",file:t}),!0),Y=(t,e)=>{const s=f.value.findIndex(r=>r.name===e.name);s!==-1&&(f.value[s].progress=100,f.value[s].status="success"),N(),_.success(`${e.name} 上传成功`)},Z=(t,e)=>{const s=f.value.findIndex(r=>r.name===e.name);s!==-1&&(f.value[s].status="exception"),_.error(`${e.name} 上传失败: ${t.message}`)},ee=t=>{f.value[t].status="exception",_.warning(`已取消上传: ${f.value[t].name}`)};return pe(()=>{U()}),(t,e)=>{const s=d("el-text"),r=d("el-option"),te=d("el-select"),m=d("el-button"),le=d("el-divider"),ae=d("el-input"),V=d("el-card"),oe=d("el-breadcrumb-item"),se=d("el-breadcrumb"),x=d("el-icon"),C=d("el-table-column"),ne=d("el-table"),de=d("el-upload"),ie=d("el-progress"),re=_e("loading");return i(),h("div",$e,[n("div",Be,[a(V,{shadow:"hover"},{default:l(()=>[n("div",ze,[a(s,{class:"control-label"},{default:l(()=>e[6]||(e[6]=[u("FLEX设备")])),_:1,__:[6]}),a(te,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),placeholder:"选择设备",style:{width:"300px"},filterable:"","allow-create":"",clearable:"",onChange:Q},{default:l(()=>[(i(!0),h(D,null,E(w.value,o=>(i(),v(r,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(m,{loading:M.value,type:"primary",size:"small",onClick:U,icon:c(fe)},{default:l(()=>e[7]||(e[7]=[u(" 刷新设备 ")])),_:1,__:[7]},8,["loading","icon"]),a(le,{direction:"vertical"}),a(s,{class:"control-label"},{default:l(()=>e[8]||(e[8]=[u("下载路径")])),_:1,__:[8]}),a(ae,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=o=>z.value=o),style:{width:"300px"},placeholder:"/data/testing_data",clearable:""},null,8,["modelValue"]),a(m,{type:"info",disabled:!y.value,onClick:A,icon:c(ve),style:{"margin-left":"20px"}},{default:l(()=>e[9]||(e[9]=[u(" 连接设备 ")])),_:1,__:[9]},8,["disabled","icon"]),a(m,{type:"primary",disabled:!y.value,onClick:J,icon:c(P),style:{"margin-left":"20px"}},{default:l(()=>e[10]||(e[10]=[u(" 下载目录 ")])),_:1,__:[10]},8,["disabled","icon"]),a(m,{type:"danger",disabled:!y.value,onClick:e[2]||(e[2]=()=>{}),icon:c(me),style:{"margin-left":"10px"}},{default:l(()=>e[11]||(e[11]=[u(" 删除目录 ")])),_:1,__:[11]},8,["disabled","icon"])])]),_:1})]),n("div",Me,[a(V,{class:"file-browser",shadow:"hover"},{header:l(()=>[n("div",Fe,[e[12]||(e[12]=n("span",null,"上传目录浏览器",-1)),n("div",Ve,[a(se,{separator:"/"},{default:l(()=>[(i(!0),h(D,null,E(L.value,(o,b)=>(i(),v(oe,{key:b,onClick:ue=>R(b)},{default:l(()=>[u(B(o||"根目录"),1)]),_:2},1032,["onClick"]))),128))]),_:1})])])]),default:l(()=>[ge((i(),v(ne,{data:q.value,style:{width:"100%"},height:"100%",onRowClick:e[5]||(e[5]=()=>{})},{default:l(()=>[a(C,{prop:"name",label:"名称",width:"300"},{default:l(({row:o})=>[n("div",De,[o.type==="directory"?(i(),v(x,{key:0},{default:l(()=>[a(c(ye))]),_:1})):(i(),v(x,{key:1},{default:l(()=>[a(c(I))]),_:1})),n("span",Ee,B(o.name),1)])]),_:1}),a(C,{prop:"size",label:"大小",width:"120"},{default:l(({row:o})=>[u(B(o.type==="directory"?"-":O(o.size)),1)]),_:1}),a(C,{prop:"modified",label:"修改时间",width:"180"}),a(C,{label:"操作",width:"150",fixed:"right"},{default:l(({row:o})=>[o.type==="file"?(i(),v(m,{key:0,size:"small",type:"primary",onClick:e[3]||(e[3]=T(b=>X(),["stop"])),icon:c(P)},{default:l(()=>e[13]||(e[13]=[u(" 下载 ")])),_:1,__:[13]},8,["icon"])):(i(),v(m,{key:1,size:"small",type:"info",onClick:e[4]||(e[4]=T(()=>{},["stop"])),icon:c(be)},{default:l(()=>e[14]||(e[14]=[u(" 进入 ")])),_:1,__:[14]},8,["icon"]))]),_:1})]),_:1},8,["data"])),[[re,F.value]])]),_:1}),a(V,{class:"upload-panel",shadow:"hover"},{header:l(()=>e[15]||(e[15]=[n("span",null,"上传文件",-1)])),default:l(()=>[a(de,{class:"upload-area",drag:"",multiple:"",action:G.value,headers:H.value,data:K.value,"before-upload":W,"on-success":Y,"on-error":Z,"show-file-list":!1,disabled:!y.value},{tip:l(()=>e[16]||(e[16]=[n("div",{class:"el-upload__tip"}," 支持上传多个文件，单文件最大100MB ",-1)])),default:l(()=>[a(x,{class:"el-icon--upload"},{default:l(()=>[a(c(he))]),_:1}),e[17]||(e[17]=n("div",{class:"el-upload__text"},[u(" 拖拽文件到此处或"),n("em",null,"点击上传")],-1))]),_:1,__:[17]},8,["action","headers","data","disabled"]),n("div",Le,[(i(!0),h(D,null,E(f.value,(o,b)=>(i(),h("div",{key:o.name+b,class:"queue-item"},[n("div",Ue,[a(x,null,{default:l(()=>[a(c(I))]),_:1}),n("span",null,B(o.name),1)]),n("div",Ne,[a(ie,{percentage:o.progress,status:o.status,"stroke-width":12},null,8,["percentage","status"])]),n("div",Pe,[o.status==="uploading"?(i(),v(m,{key:0,size:"small",type:"danger",onClick:ue=>ee(b),icon:c(ke),circle:""},null,8,["onClick","icon"])):we("",!0)])]))),128))])]),_:1})])])}}}),Se=Ce(Ie,[["__scopeId","data-v-42fe19f9"]]);export{Se as default};
