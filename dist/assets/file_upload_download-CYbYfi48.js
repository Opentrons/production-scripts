import{d as ue,r as p,i as $,D as ce,b as i,G as pe,c as k,o as d,f as o,e as s,w as t,h as u,F as D,B as L,j as v,k as c,H as _e,I as fe,J as P,K as ve,L as me,M as ge,N as I,y as B,g as T,O as ye,l as be,z as he,P as ke,$ as xe,E as m,Q as we,_ as Ce}from"./index-C7KWISnE.js";const $e={class:"file-manager-container"},Be={class:"connection-bar"},ze={class:"connection-controls"},Me={class:"main-content"},Fe={class:"browser-header"},Ve={class:"path-navigator"},De={class:"file-item"},Le={class:"file-name"},Ue={class:"upload-queue"},Ee={class:"file-info"},Ne={class:"file-progress"},Pe={class:"file-actions"},Ie=ue({__name:"file_upload_download",setup(Te){const h=p(""),U=p("/data/testing_data"),x=p([]),z=p(!1),j=p(!0),b=p(!1),f=p("/"),S=p([]),M=p(!1),q=$(()=>`/api/files/upload?device=${h.value}&path=${f.value}`),G=$(()=>({Authorization:j.value?"Bearer your-secret-token":""})),H=$(()=>({path:f.value})),_=p([]),K=l=>{if(l===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,r)).toFixed(2))+" "+n[r]},E=$(()=>f.value.split("/").filter(l=>l!==""));async function N(){z.value=!0,x.value=[];try{const e=(await xe("/api/flex/discover")).flex_group;for(const r in e)x.value.push({value:r,label:`${e[r].name} (${r})`});const n=Object.keys(e).length;n>0&&(h.value=x.value[0]),m.info(`找到${n}个设备!`)}catch(l){console.error("Error:",l),m.error("设备刷新失败: "+l.message)}finally{z.value=!1}}const O=l=>{l?b.value=!0:b.value=!1},Q=async()=>{try{M.value=!0;const l=we("/api/flex/connect",{host:h.value});console.log(l),m.success("设备连接成功")}catch(l){m.error("连接失败: "+l.message)}finally{M.value=!1}},F=async()=>{},A=l=>{l.type==="directory"&&(f.value=f.value.endsWith("/")?f.value+l.name:f.value+"/"+l.name,F())},J=l=>{const e=E.value.slice(0,l+1);f.value="/"+e.join("/"),F()},R=async l=>{},W=l=>l.size>100*1024*1024?(m.error("文件大小不能超过100MB"),!1):(_.value.push({name:l.name,size:l.size,progress:0,status:"uploading",file:l}),!0),X=(l,e)=>{const n=_.value.findIndex(r=>r.name===e.name);n!==-1&&(_.value[n].progress=100,_.value[n].status="success"),F(),m.success(`${e.name} 上传成功`)},Y=(l,e)=>{const n=_.value.findIndex(r=>r.name===e.name);n!==-1&&(_.value[n].status="exception"),m.error(`${e.name} 上传失败: ${l.message}`)},Z=l=>{_.value[l].status="exception",m.warning(`已取消上传: ${_.value[l].name}`)};return ce(()=>{N()}),(l,e)=>{const n=i("el-text"),r=i("el-option"),ee=i("el-select"),g=i("el-button"),le=i("el-divider"),te=i("el-input"),V=i("el-card"),ae=i("el-breadcrumb-item"),se=i("el-breadcrumb"),w=i("el-icon"),C=i("el-table-column"),oe=i("el-table"),ne=i("el-upload"),ie=i("el-progress"),de=pe("loading");return d(),k("div",$e,[o("div",Be,[s(V,{shadow:"hover"},{default:t(()=>[o("div",ze,[s(n,{class:"control-label"},{default:t(()=>e[5]||(e[5]=[u("FLEX设备")])),_:1,__:[5]}),s(ee,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"选择设备",style:{width:"300px"},filterable:"","allow-create":"",clearable:"",onChange:O},{default:t(()=>[(d(!0),k(D,null,L(x.value,a=>(d(),v(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(g,{loading:z.value,type:"primary",size:"small",onClick:N,icon:c(_e)},{default:t(()=>e[6]||(e[6]=[u(" 刷新设备 ")])),_:1,__:[6]},8,["loading","icon"]),s(le,{direction:"vertical"}),s(n,{class:"control-label"},{default:t(()=>e[7]||(e[7]=[u("下载路径")])),_:1,__:[7]}),s(te,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),style:{width:"300px"},placeholder:"/data/testing_data",clearable:""},null,8,["modelValue"]),s(g,{type:"info",disabled:!b.value,onClick:Q,icon:c(fe),style:{"margin-left":"20px"}},{default:t(()=>e[8]||(e[8]=[u(" 连接设备 ")])),_:1,__:[8]},8,["disabled","icon"]),s(g,{type:"primary",disabled:!b.value,onClick:e[2]||(e[2]=()=>{}),icon:c(P),style:{"margin-left":"20px"}},{default:t(()=>e[9]||(e[9]=[u(" 下载目录 ")])),_:1,__:[9]},8,["disabled","icon"]),s(g,{type:"danger",disabled:!b.value,onClick:e[3]||(e[3]=()=>{}),icon:c(ve),style:{"margin-left":"10px"}},{default:t(()=>e[10]||(e[10]=[u(" 删除目录 ")])),_:1,__:[10]},8,["disabled","icon"])])]),_:1})]),o("div",Me,[s(V,{class:"file-browser",shadow:"hover"},{header:t(()=>[o("div",Fe,[e[11]||(e[11]=o("span",null,"上传目录浏览器",-1)),o("div",Ve,[s(se,{separator:"/"},{default:t(()=>[(d(!0),k(D,null,L(E.value,(a,y)=>(d(),v(ae,{key:y,onClick:re=>J(y)},{default:t(()=>[u(B(a||"根目录"),1)]),_:2},1032,["onClick"]))),128))]),_:1})])])]),default:t(()=>[me((d(),v(oe,{data:S.value,style:{width:"100%"},height:"100%",onRowClick:e[4]||(e[4]=()=>{})},{default:t(()=>[s(C,{prop:"name",label:"名称",width:"300"},{default:t(({row:a})=>[o("div",De,[a.type==="directory"?(d(),v(w,{key:0},{default:t(()=>[s(c(ge))]),_:1})):(d(),v(w,{key:1},{default:t(()=>[s(c(I))]),_:1})),o("span",Le,B(a.name),1)])]),_:1}),s(C,{prop:"size",label:"大小",width:"120"},{default:t(({row:a})=>[u(B(a.type==="directory"?"-":K(a.size)),1)]),_:1}),s(C,{prop:"modified",label:"修改时间",width:"180"}),s(C,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[a.type==="file"?(d(),v(g,{key:0,size:"small",type:"primary",onClick:T(y=>R(a),["stop"]),icon:c(P)},{default:t(()=>e[12]||(e[12]=[u(" 下载 ")])),_:2,__:[12]},1032,["onClick","icon"])):(d(),v(g,{key:1,size:"small",type:"info",onClick:T(y=>A(a),["stop"]),icon:c(ye)},{default:t(()=>e[13]||(e[13]=[u(" 进入 ")])),_:2,__:[13]},1032,["onClick","icon"]))]),_:1})]),_:1},8,["data"])),[[de,M.value]])]),_:1}),s(V,{class:"upload-panel",shadow:"hover"},{header:t(()=>e[14]||(e[14]=[o("span",null,"上传文件",-1)])),default:t(()=>[s(ne,{class:"upload-area",drag:"",multiple:"",action:q.value,headers:G.value,data:H.value,"before-upload":W,"on-success":X,"on-error":Y,"show-file-list":!1,disabled:!b.value},{tip:t(()=>e[15]||(e[15]=[o("div",{class:"el-upload__tip"}," 支持上传多个文件，单文件最大100MB ",-1)])),default:t(()=>[s(w,{class:"el-icon--upload"},{default:t(()=>[s(c(be))]),_:1}),e[16]||(e[16]=o("div",{class:"el-upload__text"},[u(" 拖拽文件到此处或"),o("em",null,"点击上传")],-1))]),_:1,__:[16]},8,["action","headers","data","disabled"]),o("div",Ue,[(d(!0),k(D,null,L(_.value,(a,y)=>(d(),k("div",{key:a.name+y,class:"queue-item"},[o("div",Ee,[s(w,null,{default:t(()=>[s(c(I))]),_:1}),o("span",null,B(a.name),1)]),o("div",Ne,[s(ie,{percentage:a.progress,status:a.status,"stroke-width":12},null,8,["percentage","status"])]),o("div",Pe,[a.status==="uploading"?(d(),v(g,{key:0,size:"small",type:"danger",onClick:re=>Z(y),icon:c(ke),circle:""},null,8,["onClick","icon"])):he("",!0)])]))),128))])]),_:1})])])}}}),Se=Ce(Ie,[["__scopeId","data-v-cb262e44"]]);export{Se as default};
