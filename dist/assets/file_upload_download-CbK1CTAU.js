import{d as ue,r as _,i as z,D as ce,b as d,G as pe,c as w,o as r,f as s,e as a,w as o,h as u,F as V,B as E,j as m,k as c,H as _e,I as fe,J as O,K as ve,L as me,M as be,N as P,y as B,g as S,O as ge,l as ye,z as he,P as we,$ as ke,E as f,Q as xe,_ as Ce}from"./index-Cls6rUBr.js";const $e={class:"file-manager-container"},ze={class:"connection-bar"},Be={class:"connection-controls"},De={class:"main-content"},Le={class:"browser-header"},Me={class:"path-navigator"},Ue={class:"file-item"},Fe={class:"file-name"},Ve={class:"upload-queue"},Ee={class:"file-info"},Te={class:"file-progress"},je={class:"file-actions"},Ne=ue({__name:"file_upload_download",setup(Oe){const g=_(""),D=_("/data/testing_data"),k=_([]),L=_(!1),R=_(!0),y=_(!1),x=_("/"),I=_([]),M=_(!1),q=z(()=>`/api/files/upload?device=${g.value}&path=${x.value}`),G=z(()=>({Authorization:R.value?"Bearer your-secret-token":""})),H=z(()=>({path:x.value})),v=_([]),J=t=>{if(t===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,i)).toFixed(2))+" "+n[i]},T=z(()=>x.value.split("/").filter(t=>t!==""));async function j(){L.value=!0,k.value=[];try{const e=(await ke("/api/flex/discover")).flex_group;for(const i in e)k.value.push({value:i,label:`${e[i].name} (${i})`});const n=Object.keys(e).length;n>0&&(g.value=k.value[0]),f.info(`找到${n}个设备!`)}catch(t){console.error("Error:",t),f.error("设备刷新失败: "+t.message)}finally{L.value=!1}}const K=t=>{t?y.value=!0:y.value=!1},Q=async()=>{try{M.value=!0,(await xe("/api/flex/connect",{host:g.value})).success?f.success("连接成功"):f.error("连接失败")}catch(t){f.error("连接失败: "+t.message)}finally{M.value=!1}},A=async()=>{f.info("开始下载");const t={host:g.value,user_name:"root",download_path:D.value,saved_name:"testing_data"};console.log(t);const e=await fetch("/api/flex/download/testing_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Server returned ${e.status}`);const i=e.headers.get("Content-Disposition")?.match(/filename="?(.+?)"?$/)?.[1]||t.saved_name||"download.zip",U=await e.blob(),p=window.URL.createObjectURL(U),b=document.createElement("a");b.href=p,b.download=i,document.body.appendChild(b),b.click(),setTimeout(()=>{document.body.removeChild(b),window.URL.revokeObjectURL(p)},100)},N=async()=>{},X=t=>{const e=T.value.slice(0,t+1);x.value="/"+e.join("/"),N()},W=async()=>{},Y=t=>t.size>100*1024*1024?(f.error("文件大小不能超过100MB"),!1):(v.value.push({name:t.name,size:t.size,progress:0,status:"uploading",file:t}),!0),Z=(t,e)=>{const n=v.value.findIndex(i=>i.name===e.name);n!==-1&&(v.value[n].progress=100,v.value[n].status="success"),N(),f.success(`${e.name} 上传成功`)},ee=(t,e)=>{const n=v.value.findIndex(i=>i.name===e.name);n!==-1&&(v.value[n].status="exception"),f.error(`${e.name} 上传失败: ${t.message}`)},te=t=>{v.value[t].status="exception",f.warning(`已取消上传: ${v.value[t].name}`)};return ce(()=>{j()}),(t,e)=>{const n=d("el-text"),i=d("el-option"),U=d("el-select"),p=d("el-button"),b=d("el-divider"),oe=d("el-input"),F=d("el-card"),ae=d("el-breadcrumb-item"),le=d("el-breadcrumb"),C=d("el-icon"),$=d("el-table-column"),se=d("el-table"),ne=d("el-upload"),ie=d("el-progress"),de=pe("loading");return r(),w("div",$e,[s("div",ze,[a(F,{shadow:"hover"},{default:o(()=>[s("div",Be,[a(n,{class:"control-label"},{default:o(()=>e[6]||(e[6]=[u("FLEX设备")])),_:1,__:[6]}),a(U,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),placeholder:"选择设备",style:{width:"300px"},filterable:"","allow-create":"",clearable:"",onChange:K},{default:o(()=>[(r(!0),w(V,null,E(k.value,l=>(r(),m(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(p,{loading:L.value,type:"primary",size:"small",onClick:j,icon:c(_e)},{default:o(()=>e[7]||(e[7]=[u(" 刷新设备 ")])),_:1,__:[7]},8,["loading","icon"]),a(b,{direction:"vertical"}),a(n,{class:"control-label"},{default:o(()=>e[8]||(e[8]=[u("下载路径")])),_:1,__:[8]}),a(oe,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=l=>D.value=l),style:{width:"300px"},placeholder:"/data/testing_data",clearable:""},null,8,["modelValue"]),a(p,{type:"info",disabled:!y.value,onClick:Q,icon:c(fe),style:{"margin-left":"20px"}},{default:o(()=>e[9]||(e[9]=[u(" 连接设备 ")])),_:1,__:[9]},8,["disabled","icon"]),a(p,{type:"primary",disabled:!y.value,onClick:A,icon:c(O),style:{"margin-left":"20px"}},{default:o(()=>e[10]||(e[10]=[u(" 下载目录 ")])),_:1,__:[10]},8,["disabled","icon"]),a(p,{type:"danger",disabled:!y.value,onClick:e[2]||(e[2]=()=>{}),icon:c(ve),style:{"margin-left":"10px"}},{default:o(()=>e[11]||(e[11]=[u(" 删除目录 ")])),_:1,__:[11]},8,["disabled","icon"])])]),_:1})]),s("div",De,[a(F,{class:"file-browser",shadow:"hover"},{header:o(()=>[s("div",Le,[e[12]||(e[12]=s("span",null,"上传目录浏览器",-1)),s("div",Me,[a(le,{separator:"/"},{default:o(()=>[(r(!0),w(V,null,E(T.value,(l,h)=>(r(),m(ae,{key:h,onClick:re=>X(h)},{default:o(()=>[u(B(l||"根目录"),1)]),_:2},1032,["onClick"]))),128))]),_:1})])])]),default:o(()=>[me((r(),m(se,{data:I.value,style:{width:"100%"},height:"100%",onRowClick:e[5]||(e[5]=()=>{})},{default:o(()=>[a($,{prop:"name",label:"名称",width:"300"},{default:o(({row:l})=>[s("div",Ue,[l.type==="directory"?(r(),m(C,{key:0},{default:o(()=>[a(c(be))]),_:1})):(r(),m(C,{key:1},{default:o(()=>[a(c(P))]),_:1})),s("span",Fe,B(l.name),1)])]),_:1}),a($,{prop:"size",label:"大小",width:"120"},{default:o(({row:l})=>[u(B(l.type==="directory"?"-":J(l.size)),1)]),_:1}),a($,{prop:"modified",label:"修改时间",width:"180"}),a($,{label:"操作",width:"150",fixed:"right"},{default:o(({row:l})=>[l.type==="file"?(r(),m(p,{key:0,size:"small",type:"primary",onClick:e[3]||(e[3]=S(h=>W(),["stop"])),icon:c(O)},{default:o(()=>e[13]||(e[13]=[u(" 下载 ")])),_:1,__:[13]},8,["icon"])):(r(),m(p,{key:1,size:"small",type:"info",onClick:e[4]||(e[4]=S(()=>{},["stop"])),icon:c(ge)},{default:o(()=>e[14]||(e[14]=[u(" 进入 ")])),_:1,__:[14]},8,["icon"]))]),_:1})]),_:1},8,["data"])),[[de,M.value]])]),_:1}),a(F,{class:"upload-panel",shadow:"hover"},{header:o(()=>e[15]||(e[15]=[s("span",null,"上传文件",-1)])),default:o(()=>[a(ne,{class:"upload-area",drag:"",multiple:"",action:q.value,headers:G.value,data:H.value,"before-upload":Y,"on-success":Z,"on-error":ee,"show-file-list":!1,disabled:!y.value},{tip:o(()=>e[16]||(e[16]=[s("div",{class:"el-upload__tip"}," 支持上传多个文件，单文件最大100MB ",-1)])),default:o(()=>[a(C,{class:"el-icon--upload"},{default:o(()=>[a(c(ye))]),_:1}),e[17]||(e[17]=s("div",{class:"el-upload__text"},[u(" 拖拽文件到此处或"),s("em",null,"点击上传")],-1))]),_:1,__:[17]},8,["action","headers","data","disabled"]),s("div",Ve,[(r(!0),w(V,null,E(v.value,(l,h)=>(r(),w("div",{key:l.name+h,class:"queue-item"},[s("div",Ee,[a(C,null,{default:o(()=>[a(c(P))]),_:1}),s("span",null,B(l.name),1)]),s("div",Te,[a(ie,{percentage:l.progress,status:l.status,"stroke-width":12},null,8,["percentage","status"])]),s("div",je,[l.status==="uploading"?(r(),m(p,{key:0,size:"small",type:"danger",onClick:re=>te(h),icon:c(we),circle:""},null,8,["onClick","icon"])):he("",!0)])]))),128))])]),_:1})])])}}}),Se=Ce(Ne,[["__scopeId","data-v-bb59f291"]]);export{Se as default};
