import{d as we,r as d,i as M,D as ke,b as r,G as xe,c as b,o as n,f as s,e as t,w as o,h as c,F as w,B as k,j as g,k as p,H as Ce,I as $e,y as $,J as Ve,K as ze,L as De,M as P,g as ae,l as te,z as oe,N as se,$ as ne,E as h,U as Ue,_ as Be}from"./index-Dz2WQDBl.js";const Le={class:"file-manager-container"},Me={class:"connection-bar"},Fe={class:"connection-controls"},Qe={class:"main-content"},Ee={class:"browser-header"},Te={class:"path-navigator"},je={class:"file-item"},Pe={class:"file-name"},Ne={class:"upload-row"},Re={class:"upload-row"},Oe={class:"upload-queue"},Se={class:"file-info"},Ae={class:"file-progress"},Ge={class:"file-actions"},Ie={class:"upload-queue"},qe={class:"file-info"},He={class:"file-progress"},Ye={class:"file-actions"},Je=we({__name:"file_upload_download",setup(Ke){const V=d(""),F=d("/data/testing_data"),z=d([]),Q=d(!1),ue=d(!0),_=d(!1),D=d("/"),U=d("下载目录"),N=d([]),E=d(!1),R=M(()=>`/api/files/upload?device=${V.value}&path=${D.value}`),O=M(()=>({Authorization:ue.value?"Bearer your-secret-token":""})),S=M(()=>({path:D.value})),v=d([]),de=a=>{if(a===0)return"0 Bytes";const e=1024,i=["Bytes","KB","MB","GB","TB"],u=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,u)).toFixed(2))+" "+i[u]},A=M(()=>D.value.split("/").filter(a=>a!==""));async function G(){Q.value=!0,z.value=[];try{const e=(await ne("/api/flex/discover")).flex_group;for(const u in e)z.value.push({value:u,label:`${e[u].name} (${u})`});const i=Object.keys(e).length;i>0&&(V.value=z.value[0].value,_.value=!0),h.info(`找到${i}个设备!`)}catch(a){console.error("Error:",a),h.error("设备刷新失败: "+a.message)}finally{Q.value=!1}}const ie=a=>{a?_.value=!0:_.value=!1},re=async()=>{h.info("开始下载"),U.value="正在下载",_.value=!1;const a={host:V.value,user_name:"root",download_path:F.value,saved_name:"testing_data"};console.log(a);const e=await fetch(`${Ue}/api/flex/download/testing_data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok){const B=await e.json();throw h.error(`下载失败, ${B.detail}`),U.value="下载目录",_.value=!0,new Error(B.detail||`HTTP error! status: ${e.status}`)}const u=e.headers.get("Content-Disposition")?.match(/filename="?(.+?)"?$/)?.[1]||"download.zip",x=await e.blob(),m=window.URL.createObjectURL(x),y=document.createElement("a");y.href=m,y.download=u,document.body.appendChild(y),y.click(),h.success("下载成功"),U.value="下载目录",_.value=!0,setTimeout(()=>{document.body.removeChild(y),window.URL.revokeObjectURL(m)},100)},T=async()=>{try{E.value=!0;const a=await ne("/api/files/fetch/filelist");N.value=a.files.map(e=>({...e,modified:e.modified}))}catch(a){h.error("获取文件列表失败: "+a.message)}finally{E.value=!1}},ce=a=>{console.log(a);const e=A.value.slice(0,a+1);D.value="/"+e.join("/"),T()},pe=async a=>{},_e=async a=>{},ve=d([{label:"产品A",value:"product_a"},{label:"产品B",value:"product_b"},{label:"产品C",value:"product_c"}]),I=d(""),q=new Date().getFullYear(),me=d(Array.from({length:5},(a,e)=>q-e)),H=d(q),fe=d([{label:"Q1 (1-3月)",value:"Q1"},{label:"Q2 (4-6月)",value:"Q2"},{label:"Q3 (7-9月)",value:"Q3"},{label:"Q4 (10-12月)",value:"Q4"}]),Y=d(""),J=a=>a.size>100*1024*1024?(h.error("文件大小不能超过100MB"),!1):(v.value.push({name:a.name,size:a.size,progress:0,status:"uploading",file:a}),!0),K=(a,e)=>{const i=v.value.findIndex(u=>u.name===e.name);i!==-1&&(v.value[i].progress=100,v.value[i].status="success"),T(),h.success(`${e.name} 上传成功`)},X=(a,e)=>{const i=v.value.findIndex(u=>u.name===e.name);i!==-1&&(v.value[i].status="exception"),h.error(`${e.name} 上传失败: ${a.message}`)},W=a=>{v.value[a].status="exception",h.warning(`已取消上传: ${v.value[a].name}`)};return ke(()=>{G(),T()}),(a,e)=>{const i=r("el-text"),u=r("el-option"),x=r("el-select"),m=r("el-button"),y=r("el-divider"),B=r("el-input"),j=r("el-card"),be=r("el-breadcrumb-item"),ge=r("el-breadcrumb"),C=r("el-icon"),L=r("el-table-column"),he=r("el-table"),Z=r("el-upload"),ee=r("el-progress"),ye=xe("loading");return n(),b("div",Le,[s("div",Me,[t(j,{shadow:"hover"},{default:o(()=>[s("div",Fe,[t(i,{class:"control-label"},{default:o(()=>e[7]||(e[7]=[c("FLEX设备")])),_:1,__:[7]}),t(x,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),placeholder:"选择设备",style:{width:"300px"},filterable:"","allow-create":"",clearable:"",onChange:ie},{default:o(()=>[(n(!0),b(w,null,k(z.value,l=>(n(),g(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(m,{loading:Q.value,type:"primary",size:"small",onClick:G,icon:p(Ce)},{default:o(()=>e[8]||(e[8]=[c(" 刷新设备 ")])),_:1,__:[8]},8,["loading","icon"]),t(y,{direction:"vertical"}),t(i,{class:"control-label"},{default:o(()=>e[9]||(e[9]=[c("下载路径")])),_:1,__:[9]}),t(B,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=l=>F.value=l),style:{width:"300px"},placeholder:"/data/testing_data",clearable:""},null,8,["modelValue"]),t(m,{type:"primary",disabled:!_.value,onClick:re,icon:p($e),style:{"margin-left":"20px"}},{default:o(()=>[c($(U.value),1)]),_:1},8,["disabled","icon"]),t(m,{type:"danger",disabled:!_.value,onClick:e[2]||(e[2]=()=>{}),icon:p(Ve),style:{"margin-left":"10px"}},{default:o(()=>e[10]||(e[10]=[c(" 删除目录 ")])),_:1,__:[10]},8,["disabled","icon"])])]),_:1})]),s("div",Qe,[t(j,{class:"file-browser",shadow:"hover"},{header:o(()=>[s("div",Ee,[e[11]||(e[11]=s("span",null,"文件服务器",-1)),s("div",Te,[t(ge,{separator:"/"},{default:o(()=>[(n(!0),b(w,null,k(A.value,(l,f)=>(n(),g(be,{key:f,onClick:le=>ce(f)},{default:o(()=>[c($(l||"根目录"),1)]),_:2},1032,["onClick"]))),128))]),_:1})])])]),default:o(()=>[ze((n(),g(he,{data:N.value,style:{width:"100%"},height:"100%",onRowClick:e[3]||(e[3]=()=>{})},{default:o(()=>[t(L,{prop:"name",label:"名称",width:"300"},{default:o(({row:l})=>[s("div",je,[l.type==="directory"?(n(),g(C,{key:0},{default:o(()=>[t(p(De))]),_:1})):(n(),g(C,{key:1},{default:o(()=>[t(p(P))]),_:1})),s("span",Pe,$(l.name),1)])]),_:1}),t(L,{prop:"size",label:"大小",width:"120"},{default:o(({row:l})=>[c($(l.type==="directory"?"-":de(l.size)),1)]),_:1}),t(L,{prop:"modified",label:"修改时间",width:"120"}),t(L,{label:"操作",width:"220",fixed:"right"},{default:o(({row:l})=>[t(m,{size:"small",type:"primary",onClick:ae(f=>pe(l),["stop"]),title:"下载"},{default:o(()=>e[12]||(e[12]=[c(" 下载 ")])),_:2,__:[12]},1032,["onClick"]),t(m,{size:"small",type:"danger",onClick:ae(f=>_e(l),["stop"]),title:"删除",style:{"margin-left":"8px"}},{default:o(()=>e[13]||(e[13]=[c(" 删除 ")])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,E.value]])]),_:1}),t(j,{class:"upload-panel",shadow:"hover"},{default:o(()=>[e[19]||(e[19]=s("span",{style:{"margin-bottom":"12px"}},"上传到Google Drive",-1)),s("div",Ne,[t(x,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=l=>I.value=l),placeholder:"请选择产品",clearable:""},{default:o(()=>[(n(!0),b(w,null,k(ve.value,l=>(n(),g(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s("div",Re,[e[14]||(e[14]=s("span",{class:"upload-label"},"目标目录：",-1)),t(x,{modelValue:H.value,"onUpdate:modelValue":e[5]||(e[5]=l=>H.value=l),placeholder:"选择年份",style:{width:"120px"}},{default:o(()=>[(n(!0),b(w,null,k(me.value,l=>(n(),g(u,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(x,{modelValue:Y.value,"onUpdate:modelValue":e[6]||(e[6]=l=>Y.value=l),placeholder:"选择季度",style:{width:"120px","margin-left":"10px"}},{default:o(()=>[(n(!0),b(w,null,k(fe.value,l=>(n(),g(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t(Z,{class:"upload-area",drag:"",multiple:"",action:R.value,headers:O.value,data:S.value,"before-upload":J,"on-success":K,"on-error":X,"show-file-list":!1,disabled:!_.value},{tip:o(()=>e[15]||(e[15]=[s("div",{class:"el-upload__tip"}," 请选择下载的 testing_data.zip 上传 ",-1)])),default:o(()=>[t(C,{class:"el-icon--upload2"},{default:o(()=>[t(p(te))]),_:1}),e[16]||(e[16]=s("div",{class:"el-upload__text"},[c(" 拖拽文件到此处或"),s("em",null,"点击上传到Google Drive")],-1))]),_:1,__:[16]},8,["action","headers","data","disabled"]),s("div",Oe,[(n(!0),b(w,null,k(v.value,(l,f)=>(n(),b("div",{key:l.name+f,class:"queue-item"},[s("div",Se,[t(C,null,{default:o(()=>[t(p(P))]),_:1}),s("span",null,$(l.name),1)]),s("div",Ae,[t(ee,{percentage:l.progress,status:l.status,"stroke-width":12},null,8,["percentage","status"])]),s("div",Ge,[l.status==="uploading"?(n(),g(m,{key:0,size:"small",type:"danger",onClick:le=>W(f),icon:p(se),circle:""},null,8,["onClick","icon"])):oe("",!0)])]))),128))]),e[20]||(e[20]=s("span",{style:{"margin-bottom":"6px"}},"上传到文件服务器",-1)),t(Z,{class:"upload-area",drag:"",multiple:"",action:R.value,headers:O.value,data:S.value,"before-upload":J,"on-success":K,"on-error":X,"show-file-list":!1,disabled:!_.value},{tip:o(()=>e[17]||(e[17]=[s("div",{class:"el-upload__tip"}," 支持上传多个文件，单文件最大100MB ",-1)])),default:o(()=>[t(C,{class:"el-icon--upload"},{default:o(()=>[t(p(te))]),_:1}),e[18]||(e[18]=s("div",{class:"el-upload__text"},[c(" 拖拽文件到此处或"),s("em",null,"点击上传")],-1))]),_:1,__:[18]},8,["action","headers","data","disabled"]),s("div",Ie,[(n(!0),b(w,null,k(v.value,(l,f)=>(n(),b("div",{key:l.name+f,class:"queue-item"},[s("div",qe,[t(C,null,{default:o(()=>[t(p(P))]),_:1}),s("span",null,$(l.name),1)]),s("div",He,[t(ee,{percentage:l.progress,status:l.status,"stroke-width":12},null,8,["percentage","status"])]),s("div",Ye,[l.status==="uploading"?(n(),g(m,{key:0,size:"small",type:"danger",onClick:le=>W(f),icon:p(se),circle:""},null,8,["onClick","icon"])):oe("",!0)])]))),128))])]),_:1,__:[19,20]})])])}}}),We=Be(Je,[["__scopeId","data-v-03000624"]]);export{We as default};
