import{d as X,r as s,i as Y,D as Z,b as u,G as q,c as A,o as h,f,K as H,e as a,w as o,k as w,ao as J,Z as O,h as p,ap as W,j as ee,y as ae,X as N,E as C,_ as le}from"./index-Dx61kbk2.js";const te={class:"data-summary-container"},oe={class:"header"},ne={class:"action-bar"},re={class:"pagination"},se={class:"dialog-footer"},ue=X({__name:"data_summary",setup(ie){const c=s([]),b=s(!1),d=s(""),D=s("ProductionDataSummary"),g=s(10),y=s(0),_=s(!1),L=s("新建数据"),n=s({Production:"",TestName:"",NPI:"",Link:"",LinkLabel:"",CreateTime:""}),V=s(),k=async()=>{b.value=!0;try{const t=await N("/api/db/read/document",{db_name:D.value,document_name:"ProductionData2025",limit:100});c.value=t.all_docs,y.value=t.all_docs;let e=c;d.value&&(e.value=c.value.filter(r=>r.Production.toLowerCase().includes(d.value.toLowerCase())))}catch(t){C.error("获取数据失败: "+t.message)}finally{b.value=!1}},P=()=>{},S=()=>{d.value=""},T=t=>{g.value=t,k()},I=t=>{},x=()=>{L.value="新建数据",n.value={Production:"",TestName:"",NPI:"",Link:"",LinkLabel:"",CreateTime:""},_.value=!0};function z(){const t=new Date,e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${r}-${i}`}const U=t=>{},$=()=>{V.value.validate(async t=>{if(t)try{if(n.value.CreateTime=z(),n.value.Link){const e=await N("/api/db/insert/document",{db_name:"ProductionDataSummary",document_name:"ProductionData2025",collections:n.value});console.log(e),C.success(n.value.Link?"更新成功":"创建成功"),_.value=!1,k()}}catch(e){C.error("操作失败: "+e.message)}})},B=t=>{},E=Y(()=>d.value?c.value.filter(t=>t.Production.toLowerCase().includes(d.value.toLowerCase())):c.value);return Z(()=>{k()}),(t,e)=>{const r=u("el-button"),i=u("el-input"),m=u("el-table-column"),K=u("el-link"),M=u("el-table"),j=u("el-pagination"),v=u("el-form-item"),F=u("el-form"),R=u("el-dialog"),G=q("loading");return h(),A("div",te,[f("div",oe,[e[10]||(e[10]=f("h2",null,"数据汇总表",-1)),f("div",ne,[a(i,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),placeholder:"按产品名搜索",clearable:"",style:{width:"300px","margin-right":"20px"},onClear:S,onKeyup:O(P,["enter"])},{append:o(()=>[a(r,{icon:w(J),onClick:P},null,8,["icon"])]),_:1},8,["modelValue"]),a(r,{type:"primary",onClick:x,icon:w(W)},{default:o(()=>e[9]||(e[9]=[p("新建数据")])),_:1,__:[9]},8,["icon"])])]),H((h(),ee(M,{data:E.value,border:"",stripe:"",style:{width:"100%"}},{default:o(()=>[a(m,{prop:"Production",label:"产品名",width:"180",sortable:""}),a(m,{prop:"TestName",label:"测试名",width:"320"}),a(m,{prop:"NPI",label:"NPI",width:"120"}),a(m,{prop:"Link",label:"数据链接"},{default:o(({row:l})=>[a(K,{type:"primary",href:l.Link,target:"_blank"},{default:o(()=>[p(ae(l.LinkLabel),1)]),_:2},1032,["href"])]),_:1}),a(m,{prop:"CreateTime",label:"创建时间",width:"180",sortable:""}),a(m,{label:"操作",width:"150",fixed:"right"},{default:o(({row:l})=>[a(r,{size:"small",onClick:Q=>U(l)},{default:o(()=>e[11]||(e[11]=[p("编辑")])),_:2,__:[11]},1032,["onClick"]),a(r,{size:"small",type:"danger",onClick:Q=>B(l)},{default:o(()=>e[12]||(e[12]=[p("删除")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,b.value]]),f("div",re,[a(j,{"page-size":g.value,"onUpdate:pageSize":e[1]||(e[1]=l=>g.value=l),"page-sizes":[10,20,50,100],total:y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:I},null,8,["page-size","total"])]),a(R,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value=l),title:L.value,width:"50%"},{footer:o(()=>[f("span",se,[a(r,{onClick:e[7]||(e[7]=l=>_.value=!1)},{default:o(()=>e[13]||(e[13]=[p("取消")])),_:1,__:[13]}),a(r,{type:"primary",onClick:$},{default:o(()=>e[14]||(e[14]=[p("确认")])),_:1,__:[14]})])]),default:o(()=>[a(F,{model:n.value,ref_key:"formRef",ref:V,"label-width":"100px"},{default:o(()=>[a(v,{label:"产品名",prop:"Production"},{default:o(()=>[a(i,{modelValue:n.value.Production,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.Production=l),placeholder:"请输入产品名"},null,8,["modelValue"])]),_:1}),a(v,{label:"测试名",prop:"testName"},{default:o(()=>[a(i,{modelValue:n.value.TestName,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.TestName=l),placeholder:"请输入测试名"},null,8,["modelValue"])]),_:1}),a(v,{label:"NPI",prop:"NPI"},{default:o(()=>[a(i,{modelValue:n.value.NPI,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.NPI=l),placeholder:"请输入NPI"},null,8,["modelValue"])]),_:1}),a(v,{label:"链接名",prop:"LinkLabel"},{default:o(()=>[a(i,{modelValue:n.value.LinkLabel,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.LinkLabel=l),placeholder:"请输入数据链接名"},null,8,["modelValue"])]),_:1}),a(v,{label:"数据链接",prop:"Link"},{default:o(()=>[a(i,{modelValue:n.value.Link,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.Link=l),placeholder:"请输入链接"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),me=le(ue,[["__scopeId","data-v-05e53b98"]]);export{me as default};
